version: '3.8'

services:
  mkv-cleaner:
    image: ghcr.io/praadip91/mkv_url_cleaner:main
    container_name: mkv-url-cleaner
    restart: unless-stopped

    volumes:
      # Monter un point racine contenant vos dossiers sources (ex: /media)
      # Le script lira les chemins absolus configur√©s dans SOURCE_FOLDERS
      - ${SOURCE_ROOT:-/media}:/media:rw

      # Emplacement d√©di√© pour stocker cleanfile.txt (persistant sur l'h√¥te)
      - ${CLEANFILE_HOST_DIR:-/docker/mkv_url_cleaner}:/docker/mkv_url_cleaner:rw

    environment:
      # üëÄ Mode surveillance
      - WATCH_MODE=${WATCH_MODE:-True}
      - WATCH_INTERVAL=${WATCH_INTERVAL:-60}

      # üîß Param√®tres de nettoyage
      - ADD_CLEAN_SUFFIX=${ADD_CLEAN_SUFFIX:-True}
      - REMOVE_SITE_PREFIX=${REMOVE_SITE_PREFIX:-True}

      # ‚è∞ Planification horaire
      - START_HOUR=${START_HOUR:-3}
      - END_HOUR=${END_HOUR:-5}
      - ENABLE_SCHEDULING=${ENABLE_SCHEDULING:-True}

      # üìÅ Support multi-dossiers (JSON array)
      - SOURCE_FOLDERS=${SOURCE_FOLDERS:-"[/media]"}

      # Compatibilit√©: garder aussi SOURCE_FOLDER (premier dossier)
      - SOURCE_FOLDER=${SOURCE_FOLDER:-/media}

      # Chemin du fichier de suivi persistant
      - CLEANFILE_PATH=/docker/mkv_url_cleaner/cleanfile.txt

    # Limites de ressources
    deploy:
      resources:
        limits:
          cpus: '2'
          memory: 2G
        reservations:
          cpus: '0.5'
          memory: 512M

    # Logs
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"
